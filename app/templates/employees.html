{#
  Template: employees.html
  Route: employees.employee_list (GET /employees)

  Context variables:
    employees  (list[Employee]) - All employees ordered by name
#}
{% extends "base.html" %}

{% block title %}Employee Management - Product Connections Scheduler{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/employees.css') }}">
{% endblock %}

{% block content %}
    <!-- Page Header -->
    <div class="page-header" style="text-align: center; margin-bottom: var(--spacing-lg); padding-bottom: var(--spacing-md); border-bottom: 2px solid var(--pc-light-blue);">
        <h1 class="page-title" style="font-size: var(--font-size-h1); font-weight: var(--font-weight-heading); color: var(--pc-navy); margin: 0; letter-spacing: -0.02em;">Employee Management</h1>
    </div>

    <!-- Flash messages -->
    <div id="flash-messages">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <!-- Employees Section -->
    <div class="section-header">
        <h2 class="section-title">Employees</h2>
        <div class="section-actions">
            <button type="button" id="add-employee-btn" class="btn btn-primary">
                <span style="margin-right: 5px;">+</span> Add Employee
            </button>
            <button type="button" id="import-employees-btn" class="btn btn-secondary">
                <span style="margin-right: 5px;">â¬‡</span> Import Employees
            </button>
        </div>
    </div>

    <!-- Employees Grid -->
    <div id="employees-grid" class="employee-grid">
        <div class="loading">Loading employees</div>
    </div>

    <!-- Employee Statistics -->
    <div class="employee-stats">
        <h3 class="stats-title">Employee Summary</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">Total Employees</div>
                <div class="stat-value" id="stat-total">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Juicer Baristas</div>
                <div class="stat-value" id="stat-juicers">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Event Specialists</div>
                <div class="stat-value" id="stat-es">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Lead Event Specialists</div>
                <div class="stat-value" id="stat-leads">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">AB Trained</div>
                <div class="stat-value" id="stat-ab">0</div>
            </div>
        </div>
    </div>

    <!-- Add Employee Modal -->
    <div id="add-employee-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Employee</h2>
                <button class="close-modal" data-action="close-add-employee-modal">&times;</button>
            </div>

            <div id="modal-alerts"></div>

            <form id="add-employee-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="employee-id">Employee ID</label>
                        <input type="text" id="employee-id" placeholder="e.g., US814117">
                        <small style="color: var(--color-neutral-500);">Used for Crossmark integration</small>
                    </div>
                    <div class="form-group">
                        <label for="employee-name">Name *</label>
                        <input type="text" id="employee-name" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="employee-email">Email</label>
                        <input type="email" id="employee-email">
                    </div>
                    <div class="form-group">
                        <label for="employee-phone">Phone</label>
                        <input type="tel" id="employee-phone">
                    </div>
                </div>

                <div class="form-row full">
                    <div class="form-group">
                        <label for="job-title">Job Title *</label>
                        <select id="job-title" required>
                            <option value="Event Specialist">Event Specialist</option>
                            <option value="Lead Event Specialist">Lead Event Specialist</option>
                            <option value="Club Supervisor">Club Supervisor</option>
                            <option value="Juicer Barista">Juicer Barista</option>
                        </select>
                    </div>
                </div>

                <fieldset style="border: none; padding: 0; margin: 0;">
                    <legend style="font-size: 1em; font-weight: 600; color: var(--primary-color); margin-bottom: 10px;">Employee Status &amp; Training</legend>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="is-active" checked>
                            <span>Active</span>
                        </label>
                        <label>
                            <input type="checkbox" id="adult-beverage-trained">
                            <span>Adult Beverage Trained</span>
                        </label>
                        <label>
                            <input type="checkbox" id="juicer-trained">
                            <span>Juicer Trained</span>
                        </label>
                    </div>
                </fieldset>

                <fieldset style="border: none; padding: 0; margin: 20px 0 0 0;">
                    <legend style="font-size: 1em; font-weight: 600; color: var(--primary-color); margin-bottom: 10px;">Weekly Availability</legend>
                    <div class="availability-form-grid">
                        <div class="availability-form-cell">
                            <label for="avail-monday">Mon</label>
                            <input type="checkbox" id="avail-monday" checked>
                        </div>
                        <div class="availability-form-cell">
                            <label for="avail-tuesday">Tue</label>
                            <input type="checkbox" id="avail-tuesday" checked>
                        </div>
                        <div class="availability-form-cell">
                            <label for="avail-wednesday">Wed</label>
                            <input type="checkbox" id="avail-wednesday" checked>
                        </div>
                        <div class="availability-form-cell">
                            <label for="avail-thursday">Thu</label>
                            <input type="checkbox" id="avail-thursday" checked>
                        </div>
                        <div class="availability-form-cell">
                            <label for="avail-friday">Fri</label>
                            <input type="checkbox" id="avail-friday" checked>
                        </div>
                        <div class="availability-form-cell">
                            <label for="avail-saturday">Sat</label>
                            <input type="checkbox" id="avail-saturday" checked>
                        </div>
                        <div class="availability-form-cell">
                            <label for="avail-sunday">Sun</label>
                            <input type="checkbox" id="avail-sunday" checked>
                        </div>
                    </div>
                </fieldset>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" data-action="close-add-employee-modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Employee</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Employees Modal -->
    <div id="import-employees-modal" class="modal">
        <div class="modal-content" style="max-width: 580px; border-radius: 12px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--color-info-dark) 0%, var(--color-info) 100%); color: var(--color-neutral-50); padding: 20px 24px; border-bottom: none;">
                <div>
                    <h2 style="margin: 0; font-size: 20px; font-weight: 600;">Sync & Import Employees</h2>
                    <p style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.85;">Synchronize with MVRetail database</p>
                </div>
                <button class="close-modal" data-action="close-import-employees-modal" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 6px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>

            <div id="import-modal-alerts" style="padding: 0 20px;"></div>

            <div id="import-employee-list" style="padding: 20px; max-height: 450px; overflow-y: auto;">
                <div style="text-align: center; padding: 40px 20px;">
                    <div style="width: 48px; height: 48px; border: 3px solid var(--color-neutral-200); border-top-color: var(--color-info); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px;"></div>
                    <div style="color: var(--color-neutral-500); font-size: 14px;">Loading employees from MVRetail...</div>
                </div>
                <style>@keyframes spin { to { transform: rotate(360deg); } }</style>
            </div>

            <div class="modal-footer" style="background: var(--color-neutral-100); border-top: 1px solid var(--color-neutral-200); padding: 16px 20px; display: flex; justify-content: flex-end; gap: 10px;">
                <button type="button" class="btn btn-outline" data-action="close-import-employees-modal" style="padding: 10px 20px; border: 1px solid var(--color-neutral-300); background: var(--color-neutral-50); color: var(--color-neutral-600); border-radius: 6px; font-weight: 500; cursor: pointer;">Close</button>
                <button type="button" class="btn btn-primary" data-action="import-selected-employees" style="padding: 10px 20px; background: linear-gradient(135deg, var(--color-info-dark) 0%, var(--color-info) 100%); color: var(--color-neutral-50); border: none; border-radius: 6px; font-weight: 500; cursor: pointer; display: none;">Import Selected</button>
            </div>
        </div>
    </div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/employees.js') }}"></script>
<script>
// Delegated event listener for all data-action buttons
document.addEventListener('click', function(e) {
    const target = e.target.closest('[data-action]');
    if (!target) return;

    const action = target.dataset.action;

    switch (action) {
        case 'close-add-employee-modal':
            closeAddEmployeeModal();
            break;
        case 'close-import-employees-modal':
            closeImportEmployeesModal();
            break;
        case 'import-selected-employees':
            importSelectedEmployees();
            break;
    }
});
</script>
{% endblock %}
